---
import { SITE_TITLE } from "../consts";
import Logo from "./Logo.astro";

import NavbarButton from "./NavbarBurger.astro";
const navLink: { label: string; href: string }[] = [
   { label: "_home", href: "/" },
   { label: "_about", href: "/me" },
   { label: "_project", href: "/project" },
   { label: "_contact", href: "/contact" },
];
---

<nav
   class="flex items-center w-full border-b border-gray-700 flex-row justify-between"
>
   <div
      id="brand"
      class="flex items-center p-3 justify-between w-full md:w-auto border-r border-gray-700"
   >
      <a
         href="/"
         class="text-normal font-bold text-base-100 inline-flex items-center gap-x-1 md:w-48 justify-center"
      >
         <Logo />
         <span> {SITE_TITLE}</span>
      </a>
      <NavbarButton />
   </div>
   <ul
      class="hidden md:flex text-sm font-bold text-base-100 items-center h-full divide-x border-l divide-gray-700 border-gray-700"
   >
      {
         navLink.map(({ label, href }) => (
            <li class="relative group flex h-full items-center">
               <a
                  aria-current={Astro.url.pathname === href}
                  href={href}
                  class:list={[
                     "group-hover:text-primary hover:text-primary block p-3",
                     {
                        active:
                           Astro.url.pathname === href ||
                           (href !== "/" &&
                              Astro.url.pathname.startsWith(href)),
                     },
                  ]}
               >
                  {label}
               </a>
               <div class="absolute bottom-0 h-0.5 bg-primary opacity-0 transition-all duration-500 group-hover:opacity-100 group-hover:w-full w-0" />
            </li>
         ))
      }
   </ul>
</nav>
<div
   id="nav-dialog"
   class="fixed inset-0 z-20 flex justify-end group aria-hidden:hidden transition-all"
   aria-expanded="false"
   hidden
>
   <label
      id="nav-dialog-overlay"
      class="fixed inset-0 group-aria-expanded:bg-black/50 hidden group-aria-expanded:block"
   >
   </label>
   <div
      class="w-2/3 bg-neutral relative border-l border-gray-700 translate-x-full group-aria-expanded:translate-x-0 transform ease-in-out duration-300 group-aria-expanded:ease-in-out"
   >
      <nav
         class="p-8 flex items-center flex-col text-base-100 font-bold relative"
      >
         <NavbarButton _class="absolute right-0 top-0 h-[54px] w-[54px]" />
         <h1 class="text-base mb-8">{SITE_TITLE}</h1>
         <div
            class="flex flex-col justify-start w-full text-base-100 space-y-2 text-sm"
         >
            {
               navLink.map(({ label, href }) => (
                  <a href={href} class="hover:text-primary">
                     {label}
                  </a>
               ))
            }
         </div>
      </nav>
   </div>
</div>

<script>
   const burgerButton = document.querySelectorAll("#burger");
   const navDialog = document.getElementById("nav-dialog");
   const navDialogOverlay = document.getElementById("nav-dialog-overlay");

   const openNavbar = (hidden: boolean) => {
      navDialog.setAttribute("aria-expanded", hidden ? "true" : "false");
      navDialog.hidden = !hidden;
      burgerButton.forEach((btn) => {
         if (hidden) {
            btn.classList.add("active");
         } else {
            btn.classList.remove("active");
         }
      });
   };

   burgerButton.forEach((btn) => {
      btn.addEventListener("click", () => openNavbar(navDialog.hidden));
   });

   navDialogOverlay.addEventListener("click", () =>
      openNavbar(navDialog.hidden)
   );
   // Hide menu button for large screens.
   const handleViewports = (e: MediaQueryList | MediaQueryListEvent) => {
      if (e.matches) {
         openNavbar(false);
         navDialog.setAttribute("aria-hidden", "true");
      } else {
         navDialog.setAttribute("aria-hidden", "false");
      }
   };
   const mediaQueries = window.matchMedia("(min-width: 768px)");
   handleViewports(mediaQueries);
   mediaQueries.addEventListener("change", handleViewports);
</script>

<style>
   #nav-dialog[hidden] {
      pointer-events: none;
      overflow: hidden;
      opacity: 0;
      visibility: hidden;
   }
</style>
